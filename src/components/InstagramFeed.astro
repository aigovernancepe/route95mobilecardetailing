---
interface Props {
  scriptSrc: string;
}

const { scriptSrc } = Astro.props;
---

<section class="py-16 lg:py-24 bg-gray-50">
  <div class="max-w-7xl mx-auto px-4">
    <div class="text-center mb-12">
      <h2 class="text-3xl lg:text-4xl font-bold text-[#0f2a4a] mb-4">
        See Our Work
      </h2>
      <p class="text-lg text-gray-600 max-w-3xl mx-auto">
        Follow us on Instagram for the latest before-and-after results.
      </p>
    </div>
    <div class="trustindex-widget" data-script-src={scriptSrc}></div>
  </div>
</section>

<script>
  function loadTrustindex(src: string) {
    if (document.querySelector(`script[src="${src}"]`)) return;
    const script = document.createElement('script');
    script.src = src;
    script.defer = true;
    script.async = true;
    document.head.appendChild(script);
  }

  const widgets = document.querySelectorAll('.trustindex-widget');
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const src = (entry.target as HTMLElement).dataset.scriptSrc;
        if (src) loadTrustindex(src);
        observer.unobserve(entry.target);
      }
    });
  }, { rootMargin: '200px' });

  widgets.forEach(widget => observer.observe(widget));
</script>
