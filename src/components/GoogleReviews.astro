---
import { getTranslations, type Locale } from '../i18n/utils';

interface Props {
  widgetId?: string;
  locale?: string;
}

const { widgetId = 'REPLACE_WITH_YOUR_ELFSIGHT_WIDGET_ID', locale: localeProp } = Astro.props;
const locale = (localeProp ?? Astro.currentLocale ?? 'en') as Locale;
const t = getTranslations(locale);
---

<section class="py-16 lg:py-24 bg-gray-50">
  <div class="max-w-7xl mx-auto px-4">
    <div class="text-center mb-12">
      <h2 class="text-3xl lg:text-4xl font-bold text-[#0f2a4a] mb-4">
        {t.googleReviews.heading}
      </h2>
      <p class="text-lg text-gray-600 max-w-3xl mx-auto">
        {t.googleReviews.description}
      </p>
    </div>
    <div class="elfsight-widget" data-widget-id={widgetId}>
      <div class={`elfsight-app-${widgetId}`} data-elfsight-app-lazy></div>
    </div>
  </div>
</section>

<script>
  function loadElfsight() {
    if (document.querySelector('script[src="https://elfsightcdn.com/platform.js"]')) return;
    const script = document.createElement('script');
    script.src = 'https://elfsightcdn.com/platform.js';
    script.async = true;
    document.head.appendChild(script);
  }

  const widgets = document.querySelectorAll('.elfsight-widget');
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        loadElfsight();
        observer.unobserve(entry.target);
      }
    });
  }, { rootMargin: '200px' });

  widgets.forEach(widget => observer.observe(widget));
</script>
